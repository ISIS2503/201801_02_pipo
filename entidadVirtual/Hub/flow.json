[{"id":"a92d6573.4c3468","type":"tab","label":"Telemetry Flow","disabled":false,"info":""},{"id":"dbd615be.08da88","type":"inject","z":"a92d6573.4c3468","name":"Send Time","topic":"emergencyTime","payload":"","payloadType":"date","repeat":"1","crontab":"","once":true,"onceDelay":"0","x":150,"y":220,"wires":[["51c522d6.027a1c","c5771f9c.f4d8c"]]},{"id":"dab7ae30.4e3f5","type":"function","z":"a92d6573.4c3468","name":"Format Physical Entity","func":"var res = {};\nvar tempArray = [];\nvar tempUnit = \"\";\n\nvar apartamento=\"2-503\"\nvar conjunto=\"Toscana\"\n\ntempArray = msg.payload.split(\"\\t\");\nres.topic = \"emergencyHub\";\nres.payload = {};\n\nres.payload = {\"id\": tempArray[0], \"emergencia\":tempArray[1][0],\"apartamento\": apartamento, \"conjunto\": conjunto}\n\nreturn res;","outputs":1,"noerr":0,"x":420,"y":180,"wires":[["59853ee6.cf5f1","993ad932.a325f8"]]},{"id":"51c522d6.027a1c","type":"function","z":"a92d6573.4c3468","name":"Format Time","func":"var res = {};\n\n\nres.payload = new Date(msg.payload);\nres.topic = msg.topic;\n\nreturn res;","outputs":1,"noerr":0,"x":410,"y":300,"wires":[["a735e0b1.0de4c","993ad932.a325f8"]]},{"id":"1ea50453.1ce4ac","type":"debug","z":"a92d6573.4c3468","name":"Before Format 1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":560,"y":40,"wires":[]},{"id":"59853ee6.cf5f1","type":"debug","z":"a92d6573.4c3468","name":"After Format","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":650,"y":140,"wires":[]},{"id":"c5771f9c.f4d8c","type":"debug","z":"a92d6573.4c3468","name":"Before Format 2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":420,"y":240,"wires":[]},{"id":"a735e0b1.0de4c","type":"debug","z":"a92d6573.4c3468","name":"After Format 2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":640,"y":320,"wires":[]},{"id":"993ad932.a325f8","type":"function","z":"a92d6573.4c3468","name":"Merge 2 Messages","func":"context.data = context.data || {};\n\nswitch (msg.topic) \n{\n    case \"emergencyTime\":\n        context.data.sensetime = msg.payload;\n        msg = null;\n        break;\n    case \"emergencyHub\":\n        context.data.emergency = msg.payload;\n        context.flag=msg.payload.emergencia;\n        msg = null;\n        break;\n    default:\n        msg = null;\n    \tbreak;\n}\n\nif(context.flag!=null && context.data.sensetime != null && context.data.emergency != null) \n{\n\tres = {};\n    res.payload = JSON.stringify(context.data);\n    res.flag=context.flag;\n    res.topic = \"emergencyHub\";\n    context.data = null;\n    \n    return res;\n}","outputs":1,"noerr":0,"x":750,"y":240,"wires":[["82f160a.e8540a","60fe55de.3ee36c","b945864.e655f78"]]},{"id":"6daf82f3.d7619c","type":"debug","z":"a92d6573.4c3468","name":"After Merge 1 ","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1240,"y":140,"wires":[]},{"id":"7b7e6b21.f84af4","type":"mqtt out","z":"a92d6573.4c3468","name":"Emergency 1","topic":"Toscana/emergencia/puertaAbierta/2-503","qos":"0","retain":"false","broker":"21b19ad3.79c22e","x":1190,"y":60,"wires":[]},{"id":"82f160a.e8540a","type":"switch","z":"a92d6573.4c3468","name":"Classify emergency","property":"flag","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"eq","v":"2","vt":"str"},{"t":"eq","v":"3","vt":"str"},{"t":"eq","v":"4","vt":"str"}],"checkall":"false","repair":false,"outputs":4,"x":1010,"y":240,"wires":[["7b7e6b21.f84af4","6daf82f3.d7619c"],["39f9e2a6.19502e","69eab570.7130ec"],["6bb5a62c.8d7a18","f4d015b8.880428"],["d1e50e9f.fa094","251ae892.2aedb8"]]},{"id":"39f9e2a6.19502e","type":"mqtt out","z":"a92d6573.4c3468","name":"Emergency 2","topic":"Toscana/emergencia/aperturaSospechosa/2-503","qos":"0","retain":"false","broker":"21b19ad3.79c22e","x":1250,"y":200,"wires":[]},{"id":"69eab570.7130ec","type":"debug","z":"a92d6573.4c3468","name":"After Merge 2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1320,"y":260,"wires":[]},{"id":"6bb5a62c.8d7a18","type":"mqtt out","z":"a92d6573.4c3468","name":"Emergency 3","topic":"Toscana/emergencia/aperturaNoPermitida/2-503","qos":"0","retain":"false","broker":"21b19ad3.79c22e","x":1290,"y":320,"wires":[]},{"id":"f4d015b8.880428","type":"debug","z":"a92d6573.4c3468","name":"After Merge 3","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1260,"y":380,"wires":[]},{"id":"d1e50e9f.fa094","type":"mqtt out","z":"a92d6573.4c3468","name":"Emergency 4","topic":"Toscana/emergencia/bateriaCritica/2-503","qos":"0","retain":"false","broker":"21b19ad3.79c22e","x":1130,"y":440,"wires":[]},{"id":"251ae892.2aedb8","type":"debug","z":"a92d6573.4c3468","name":"After Merge 4","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1080,"y":500,"wires":[]},{"id":"60fe55de.3ee36c","type":"debug","z":"a92d6573.4c3468","name":"Flag","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"flag","x":850,"y":340,"wires":[]},{"id":"b945864.e655f78","type":"debug","z":"a92d6573.4c3468","name":"Merge","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":890,"y":100,"wires":[]},{"id":"8edaed7e.815cd","type":"mqtt in","z":"a92d6573.4c3468","name":"","topic":"Arduino007/envio","qos":"0","broker":"21b19ad3.79c22e","x":100,"y":140,"wires":[[]]},{"id":"421a1ffa.adb24","type":"inject","z":"a92d6573.4c3468","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":60,"wires":[["60972845.c1bd78"]]},{"id":"60972845.c1bd78","type":"random","z":"a92d6573.4c3468","name":"Random emergency","low":"1","high":"4","inte":"true","x":260,"y":20,"wires":[["b435a1c1.22721"]]},{"id":"b435a1c1.22721","type":"function","z":"a92d6573.4c3468","name":"Physical Entity mock","func":"msg.payload=\"Arduino007\\t\"+msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":120,"wires":[["1ea50453.1ce4ac","dab7ae30.4e3f5"]]},{"id":"21b19ad3.79c22e","type":"mqtt-broker","z":"","name":"","broker":"172.24.42.33","port":"8083","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"willTopic":"","willQos":"0","willPayload":"","birthTopic":"","birthQos":"0","birthPayload":""}]